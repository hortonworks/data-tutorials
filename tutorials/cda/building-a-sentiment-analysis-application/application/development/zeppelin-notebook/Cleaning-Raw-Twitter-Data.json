{"paragraphs":[{"text":"%spark2\r\nimport org.apache.spark._\r\nimport org.apache.spark.rdd._\r\nimport org.apache.spark.SparkContext._\r\nimport org.apache.spark.mllib.feature.HashingTF\r\nimport org.apache.spark.{SparkConf, SparkContext}\r\nimport org.apache.spark.mllib.regression.LabeledPoint\r\nimport org.apache.spark.mllib.tree.GradientBoostedTrees\r\nimport org.apache.spark.mllib.tree.configuration.BoostingStrategy\r\nimport org.apache.spark._\r\nimport org.apache.spark.rdd._\r\nimport org.apache.spark.SparkContext._\r\nimport scala.util.{Success, Try}\r\n\r\n    val sqlContext = new org.apache.spark.sql.SQLContext(sc)\r\n\r\n    var tweetDF = sqlContext.read.json(\"hdfs:///sandbox/tutorial-files/770/tweets_staging/*\")\r\n    tweetDF.show()","user":"anonymous","dateUpdated":"2018-09-23T00:56:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.rdd._\nimport org.apache.spark.SparkContext._\nimport org.apache.spark.mllib.feature.HashingTF\nimport org.apache.spark.{SparkConf, SparkContext}\nimport org.apache.spark.mllib.regression.LabeledPoint\nimport org.apache.spark.mllib.tree.GradientBoostedTrees\nimport org.apache.spark.mllib.tree.configuration.BoostingStrategy\nimport org.apache.spark._\nimport org.apache.spark.rdd._\nimport org.apache.spark.SparkContext._\nimport scala.util.{Success, Try}\nwarning: there was one deprecation warning; re-run with -deprecation for details\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@6e46a458\ntweetDF: org.apache.spark.sql.DataFrame = [_corrupt_record: string, created_time: string ... 6 more fields]\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\n|_corrupt_record|        created_time|created_unixtime|    displayname|lang|                 msg|           time_zone|          tweet_id|\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\n|           null|Wed Mar 15 00:37:...|   1489538246855| amanda_obrien_|  en|when i was little...|                    |841810537394667520|\n|           null|Wed Mar 15 00:37:...|   1489538246983|   tinxdelacruz|  en|RT NashLenersOFC ...|             Beijing|841810537931456512|\n|           null|Wed Mar 15 00:37:...|   1489538247091|  esteladic2126|  es|RT Sugarlapin8 Te...|                    |841810538384384000|\n|           null|Wed Mar 15 00:37:...|   1489538247086|      _cabrisun|  en|poppinmahle happy...|Atlantic Time (Ca...|841810538363535360|\n|           null|Wed Mar 15 00:37:...|   1489538247093|    shabadoobie|  en|RT robinthede Rea...|Eastern Time (US ...|841810538392891392|\n|           null|Wed Mar 15 00:37:...|   1489538247076|   wompastompa1|  en|RT bwecht Happy B...|                    |841810538321612800|\n|           null|Wed Mar 15 00:37:...|   1489538247109|      NjDiestro|  tl|Happy birthday br...|                    |841810538459885568|\n|           null|Wed Mar 15 00:37:...|   1489538247233|     itschloooe|  en|How happy would u...|              London|841810538980089857|\n|           null|Wed Mar 15 00:37:...|   1489538247391|   paulinejoy97|  en|RT ohmybaequotes ...|                    |841810539642724353|\n|           null|Wed Mar 15 00:37:...|   1489538247248|5e1628bb947d498|  en|RT andibeth012 Si...|                    |841810539043004416|\n|           null|Wed Mar 15 00:37:...|   1489538247404|         dbsudg|  ja|【連載マンガ】「ほしとくずDont...|                    |841810539697201152|\n|           null|Wed Mar 15 00:37:...|   1489538247335|DrClarkIPresume|  en|RT KenJennings Th...|              Hawaii|841810539407908864|\n|           null|Wed Mar 15 00:37:...|   1489538247399|    kurokita666|  ja|RT 1717frappuccin...|                    |841810539676291072|\n|           null|Wed Mar 15 00:37:...|   1489538247522|     sherrygrey|  en|SusanSarandon So ...|                    |841810540192178176|\n|           null|Wed Mar 15 00:37:...|   1489538247456|       CTudor88|  en|Pet peeve its ven...|Eastern Time (US ...|841810539915415552|\n|           null|Wed Mar 15 00:37:...|   1489538247123| TheOfficialRK_|  en|Yo happy birthday...|Eastern Time (US ...|841810538518700034|\n|           null|Wed Mar 15 00:37:...|   1489538247618|     EricFundak|  en|RT richthekid Foc...|Pacific Time (US ...|841810540594925568|\n|           null|Wed Mar 15 00:37:...|   1489538247505|          bin99|  en|RT davidfrawleyve...|              Mumbai|841810540120969216|\n|           null|Wed Mar 15 00:37:...|   1489538247621|        yxzmin_|  es|RT carlosbugani s...|Pacific Time (US ...|841810540607467520|\n|           null|Wed Mar 15 00:37:...|   1489538247831|        Viffido|  en|RT bwecht Happy B...|             Caracas|841810541488267266|\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1537658573626_-1667430310","id":"20180922-232253_21748668","dateCreated":"2018-09-22T23:22:53+0000","dateStarted":"2018-09-23T00:56:59+0000","dateFinished":"2018-09-23T00:57:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:282","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=0","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=1","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=2","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=3"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\r\nvar messages = tweetDF.select(\"msg\")\r\nprintln(\"Total messages: \" + messages.count())\r\n\r\nvar happyMessages = messages.filter(messages(\"msg\").contains(\"happy\"))\r\nval countHappy = happyMessages.count()\r\nprintln(\"Number of happy messages: \" +  countHappy)\r\n\r\nvar unhappyMessages = messages.filter(messages(\"msg\").contains(\" sad\"))\r\nval countUnhappy = unhappyMessages.count()\r\nprintln(\"Unhappy Messages: \" + countUnhappy)\r\n\r\nval smallest = Math.min(countHappy, countUnhappy).toInt\r\n\r\n//Create a dataset with equal parts happy and unhappy messages\r\nvar tweets = happyMessages.limit(smallest).unionAll(unhappyMessages.limit(smallest))","user":"anonymous","dateUpdated":"2018-09-23T00:57:29+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537659256211_-1154135813","id":"20180922-233416_1650225670","dateCreated":"2018-09-22T23:34:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:283","dateFinished":"2018-09-23T00:57:39+0000","dateStarted":"2018-09-23T00:57:29+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"messages: org.apache.spark.sql.DataFrame = [msg: string]\nTotal messages: 14440\nhappyMessages: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\ncountHappy: Long = 5351\nNumber of happy messages: 5351\nunhappyMessages: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\ncountUnhappy: Long = 1932\nUnhappy Messages: 1932\nsmallest: Int = 1932\nwarning: there was one deprecation warning; re-run with -deprecation for details\ntweets: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=4","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=5","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=6"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\nval messagesRDD = tweets.rdd\n//We use scala's Try to filter out tweets that couldn't be parsed\nval goodBadRecords = messagesRDD.map(\n  row =>{\n    Try{\n      val msg = row(0).toString.toLowerCase()\n      var isHappy:Int = 0\n      if(msg.contains(\" sad\")){\n        isHappy = 0\n      }else if(msg.contains(\"happy\")){\n        isHappy = 1\n      }\n      var msgSanitized = msg.replaceAll(\"happy\", \"\")\n      msgSanitized = msgSanitized.replaceAll(\"sad\",\"\")\n      //Return a tuple\n      (isHappy, msgSanitized.split(\" \").toSeq)\n    }\n  }\n)\n\n//We use this syntax to filter out exceptions\nval exceptions = goodBadRecords.filter(_.isFailure)\nprintln(\"total records with exceptions: \" + exceptions.count())\nexceptions.take(10).foreach(x => println(x.failed))\nvar labeledTweets = goodBadRecords.filter((_.isSuccess)).map(_.get)\nprintln(\"total records with successes: \" + labeledTweets.count())","user":"anonymous","dateUpdated":"2018-09-23T00:59:52+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664110765_-237719928","id":"20180923-005510_1500453897","dateCreated":"2018-09-23T00:55:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:443","dateFinished":"2018-09-23T00:59:59+0000","dateStarted":"2018-09-23T00:59:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"messagesRDD: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[44] at rdd at <console>:67\ngoodBadRecords: org.apache.spark.rdd.RDD[scala.util.Try[(Int, Seq[String])]] = MapPartitionsRDD[45] at map at <console>:71\nexceptions: org.apache.spark.rdd.RDD[scala.util.Try[(Int, Seq[String])]] = MapPartitionsRDD[46] at filter at <console>:73\ntotal records with exceptions: 0\nlabeledTweets: org.apache.spark.rdd.RDD[(Int, Seq[String])] = MapPartitionsRDD[48] at map at <console>:71\ntotal records with successes: 3864\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=7","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=8","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=9","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=10"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\nlabeledTweets.take(10).foreach(x => println(x))","user":"anonymous","dateUpdated":"2018-09-23T01:00:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664392085_526140199","id":"20180923-005952_1994983650","dateCreated":"2018-09-23T00:59:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:663","dateFinished":"2018-09-23T01:00:59+0000","dateStarted":"2018-09-23T01:00:58+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(1,WrappedArray(poppinmahle, , bday, pretty, girl😍🎈🎉))\n(1,WrappedArray(rt, robinthede, really, some, are, disappointed, that, maddow, only, has, 2005, like, you, would, only, be, , w/, 20, yrs, of, indepth, tax, analysis…))\n(1,WrappedArray(how, , would, u, be, if, you, could, be, shauna, for, one, —, i, think, id, be, so, , that, when, i, went, back, to, be, https//tco/h93kv9evge))\n(1,WrappedArray(rt, ohmybaequotes, being, single, is, different, from, being, alone, im, single, and, im, , with, it))\n(1,WrappedArray(【連載マンガ】「ほしとくずdont, worry, be, , chapter01」を読みました！人気マンガが無料で読める！lineマンガ今スグ読む→, https//tco/sjwmpvyiba, lineマンガ))\n(1,WrappedArray(yo, , birthday, homie, bmxandrewwhipps, https//tco/7ec4dzgzly))\n(1,WrappedArray(rt, richthekid, focus, on, what, makes, you))\n(1,WrappedArray(rt, krizzyfollman, take, risks, be, , stay, positive, , aldubxdtbytugofhearts))\n(1,WrappedArray(i, hope, youre))\n(1,WrappedArray(rt, 2jaespics, , couple, https//tco/dke7fyfzah))\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=11"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\nval hashingTF = new HashingTF(2000)\n\n//Map the input strings to a tuple of labeled point + input text\nval input_labeled = (labeledTweets.map(\n  t => (t._1, hashingTF.transform(t._2)))\n  .map(x => new LabeledPoint((x._1).toDouble, x._2)))","user":"anonymous","dateUpdated":"2018-09-23T01:02:12+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664458455_-300051821","id":"20180923-010058_392111761","dateCreated":"2018-09-23T01:00:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:788","dateFinished":"2018-09-23T01:02:14+0000","dateStarted":"2018-09-23T01:02:13+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"hashingTF: org.apache.spark.mllib.feature.HashingTF = org.apache.spark.mllib.feature.HashingTF@1b668b2\ninput_labeled: org.apache.spark.rdd.RDD[org.apache.spark.mllib.regression.LabeledPoint] = MapPartitionsRDD[50] at map at <console>:79\n"}]}},{"text":"%spark2\ninput_labeled.take(10).foreach(println)","user":"anonymous","dateUpdated":"2018-09-23T01:03:02+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664532663_1634850587","id":"20180923-010212_307037180","dateCreated":"2018-09-23T01:02:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:906","dateFinished":"2018-09-23T01:03:05+0000","dateStarted":"2018-09-23T01:03:02+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(1.0,(2000,[405,775,1372,1754,1993],[1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[163,201,343,433,580,584,630,656,899,1138,1310,1320,1330,1371,1372,1400,1425,1433,1541,1543,1643,1746,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[44,163,170,213,237,388,430,656,674,688,781,1036,1076,1329,1368,1371,1372,1425,1526,1564,1604,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,4.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[333,374,433,495,531,682,777,1089,1281,1372,1567,1650,1921],[1.0,2.0,1.0,1.0,2.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[362,368,656,1258,1372,1715,1945],[1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[295,543,597,1023,1124,1372],[1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[82,433,479,526,1425,1690,1691],[1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[1,96,433,656,855,1140,1372,1809],[1.0,1.0,2.0,1.0,1.0,1.0,2.0,1.0]))\n(1.0,(2000,[0,1329,1472],[1.0,1.0,1.0]))\n(1.0,(2000,[433,910,1372,1426,1988],[1.0,1.0,1.0,1.0,1.0]))\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=12"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\r\n//We're keeping the raw text for inspection later\r\nvar sample = (labeledTweets.take(1000).map(\r\n  t => (t._1, hashingTF.transform(t._2), t._2))\r\n  .map(x => (new LabeledPoint((x._1).toDouble, x._2), x._3)))","user":"anonymous","dateUpdated":"2018-09-23T01:04:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664582040_-715468804","id":"20180923-010302_178903830","dateCreated":"2018-09-23T01:03:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1003","dateFinished":"2018-09-23T01:04:13+0000","dateStarted":"2018-09-23T01:04:12+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sample: Array[(org.apache.spark.mllib.regression.LabeledPoint, Seq[String])] = Array(((1.0,(2000,[405,775,1372,1754,1993],[1.0,1.0,1.0,1.0,1.0])),WrappedArray(poppinmahle, \"\", bday, pretty, girl😍🎈🎉)), ((1.0,(2000,[163,201,343,433,580,584,630,656,899,1138,1310,1320,1330,1371,1372,1400,1425,1433,1541,1543,1643,1746,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])),WrappedArray(rt, robinthede, really, some, are, disappointed, that, maddow, only, has, 2005, like, you, would, only, be, \"\", w/, 20, yrs, of, indepth, tax, analysis…)), ((1.0,(2000,[44,163,170,213,237,388,430,656,674,688,781,1036,1076,1329,1368,1371,1372,1425,1526,1564,1604,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,4.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0])),Wrap..."}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=13"],"interpreterSettingId":"spark2"}}},{"text":"%spark2\n","user":"anonymous","dateUpdated":"2018-09-23T01:04:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537664651826_-112581248","id":"20180923-010411_7567858","dateCreated":"2018-09-23T01:04:11+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1118"}],"name":"Cleaning-Raw-Twitter-Data","id":"2DTNR3BJ7","noteParams":{},"noteForms":{},"angularObjects":{"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}